#include "attributesForCortexM4.inc"

	.code	16
	
	.file	"cortex_m4_mpy_256.S"
	
	.text
	.align	2

// ****************************************************
// Implementation of 256x256 bit => 512 bit multiply.
// uses packed non-redundant representation.
// 
// 
// implements the interface
//
// void
// multiply_256x256_asm (UN_512bitValue *pResult, const UN_256bitValue *pVal1, const UN_256bitValue *pVal2); 
//	
// in:
//    r0 == ptr to Result word
//    r1, r2 == prts to values to multiply

	.global	multiply256x256_asm
	.type	multiply256x256_asm, %function
multiply256x256_asm:
// ######################
// ASM 256x256:
// ######################
 // START: mul 256x256 textbook r0 = result ptr, r1,r2 = operand ptr.
    .syntax unified
    push {r0,r1,r2,r4,r5,r6,r7,r8,r9,r10,r11,r12,r14}
   .syntax divided
    ldr r3,[r2,#0]
    ldr r4,[r2,#4]
    ldr r5,[r2,#8]
    ldr r6,[r2,#12]
    ldr r7,[r2,#16]
    ldr r2,[r1,#0]
    .syntax unified
    eor r8,r8
   .syntax divided
    .syntax unified
    umull r9,r10,r8,r8
   .syntax divided
    .syntax unified
    eor r11,r11
   .syntax divided
    .syntax unified
    umull r12,r14,r2,r3
   .syntax divided
    .syntax unified
    umlal r14,r8,r2,r4
   .syntax divided
    .syntax unified
    umlal r8,r9,r2,r5
   .syntax divided
    .syntax unified
    umlal r9,r10,r2,r6
   .syntax divided
    .syntax unified
    str r12,[r0,#0]
    .syntax divided
    .syntax unified
    eor r12,r12
   .syntax divided
    .syntax unified
    umlal r10,r11,r2,r7
   .syntax divided
    ldr r2,[r1,#4]
    .syntax unified
    umlal r14,r12,r2,r3
   .syntax divided
    .syntax unified
    umaal r8,r12,r2,r4
   .syntax divided
    .syntax unified
    umaal r9,r12,r2,r5
   .syntax divided
    .syntax unified
    umaal r10,r12,r2,r6
   .syntax divided
    .syntax unified
    str r14,[r0,#4]
    .syntax divided
    .syntax unified
    eor r14,r14
   .syntax divided
    .syntax unified
    umaal r11,r12,r2,r7
   .syntax divided
    ldr r2,[r1,#8]
    .syntax unified
    umlal r8,r14,r2,r3
   .syntax divided
    .syntax unified
    umaal r9,r14,r2,r4
   .syntax divided
    .syntax unified
    umaal r10,r14,r2,r5
   .syntax divided
    .syntax unified
    umaal r11,r14,r2,r6
   .syntax divided
    .syntax unified
    str r8,[r0,#8]
    .syntax divided
    .syntax unified
    eor r8,r8
   .syntax divided
    .syntax unified
    umaal r12,r14,r2,r7
   .syntax divided
    ldr r2,[r1,#12]
    .syntax unified
    umlal r9,r8,r2,r3
   .syntax divided
    .syntax unified
    umaal r8,r10,r2,r4
   .syntax divided
    .syntax unified
    umaal r10,r11,r2,r5
   .syntax divided
    .syntax unified
    umaal r11,r12,r2,r6
   .syntax divided
    .syntax unified
    str r9,[r0,#12]
    .syntax divided
    .syntax unified
    eor r9,r9
   .syntax divided
    .syntax unified
    umaal r12,r14,r2,r7
   .syntax divided
    ldr r2,[r1,#16]
    .syntax unified
    umlal r8,r9,r2,r3
   .syntax divided
    .syntax unified
    umaal r9,r10,r2,r4
   .syntax divided
    .syntax unified
    umaal r10,r11,r2,r5
   .syntax divided
    .syntax unified
    umaal r11,r12,r2,r6
   .syntax divided
    .syntax unified
    str r8,[r0,#16]
    .syntax divided
    .syntax unified
    eor r8,r8
   .syntax divided
    .syntax unified
    umaal r12,r14,r2,r7
   .syntax divided
    ldr r2,[r1,#20]
    .syntax unified
    umlal r9,r8,r2,r3
   .syntax divided
    .syntax unified
    umaal r8,r10,r2,r4
   .syntax divided
    ldr r2,[SP,#8]
    ldr r3,[r2,#20]
    ldr r4,[r2,#24]
    ldr r5,[r1,#0]
    .syntax unified
    eor r6,r6
   .syntax divided
    .syntax unified
    umlal r9,r6,r5,r3
   .syntax divided
    .syntax unified
    umaal r6,r8,r5,r4
   .syntax divided
    .syntax unified
    str r9,[r0,#20]
    .syntax divided
    .syntax unified
    eor r7,r7
    ldr r9,[r2,#28]
    .syntax unified
    umaal r8,r10,r5,r9
   .syntax divided
    ldr r5,[r1,#4]
    .syntax unified
    umlal r6,r7,r5,r3
   .syntax divided
    .syntax unified
    umaal r7,r8,r5,r4
   .syntax divided
    .syntax unified
    umaal r8,r10,r5,r9
   .syntax divided
    ldr r5,[r1,#8]
    .syntax unified
    umaal r7,r11,r5,r3
   .syntax divided
    .syntax unified
    umaal r8,r11,r5,r4
   .syntax divided
    .syntax unified
    umaal r10,r11,r5,r9
   .syntax divided
    ldr r5,[r1,#12]
    .syntax unified
    umaal r8,r12,r5,r3
   .syntax divided
    .syntax unified
    umaal r10,r12,r5,r4
   .syntax divided
    .syntax unified
    umaal r11,r12,r5,r9
   .syntax divided
    ldr r5,[r1,#16]
    .syntax unified
    umaal r10,r14,r5,r3
   .syntax divided
    .syntax unified
    umaal r11,r14,r5,r4
   .syntax divided
    .syntax unified
    umaal r12,r14,r5,r9
   .syntax divided
    ldr r5,[r1,#24]
    ldr r3,[r2,#0]
    ldr r4,[r2,#4]
    .syntax unified
    eor r9,r9
   .syntax divided
    .syntax unified
    umlal r6,r9,r5,r3
   .syntax divided
    .syntax unified
    umaal r7,r9,r5,r4
   .syntax divided
    .syntax unified
    str r6,[r0,#24]
    .syntax divided
    ldr r6,[r2,#8]
    .syntax unified
    umaal r8,r9,r5,r6
   .syntax divided
    ldr r5,[r1,#20]
    .syntax unified
    eor r2,r2
   .syntax divided
    .syntax unified
    umlal r7,r2,r5,r6
   .syntax divided
    ldr r5,[r1,#28]
    .syntax unified
    eor r1,r1
   .syntax divided
    .syntax unified
    umlal r7,r1,r5,r3
   .syntax divided
    .syntax unified
    str r7,[r0,#28]
    .syntax divided
    .syntax unified
    umaal r1,r2,r5,r4
   .syntax divided
    .syntax unified
    umaal r2,r9,r5,r6
   .syntax divided
    ldr r3,[SP,#4]
    ldr r4,[r3,#20]
    ldr r6,[r3,#24]
    ldr r3,[SP,#8]
    ldr r7,[r3,#12]
    .syntax unified
    umaal r1,r8,r4,r7
   .syntax divided
    .syntax unified
    str r1,[r0,#32]
    .syntax divided
    .syntax unified
    umaal r2,r8,r6,r7
   .syntax divided
    .syntax unified
    umaal r8,r9,r5,r7
   .syntax divided
    ldr r1,[r3,#16]
    .syntax unified
    umaal r2,r10,r4,r1
   .syntax divided
    .syntax unified
    umaal r8,r10,r6,r1
   .syntax divided
    .syntax unified
    umaal r9,r10,r5,r1
   .syntax divided
    ldr r1,[r3,#20]
    .syntax unified
    umaal r8,r11,r4,r1
   .syntax divided
    .syntax unified
    umaal r9,r11,r6,r1
   .syntax divided
    .syntax unified
    umaal r10,r11,r5,r1
   .syntax divided
    ldr r1,[r3,#24]
    .syntax unified
    umaal r9,r12,r4,r1
   .syntax divided
    .syntax unified
    umaal r10,r12,r6,r1
   .syntax divided
    .syntax unified
    umaal r11,r12,r5,r1
   .syntax divided
    ldr r1,[r3,#28]
    .syntax unified
    umaal r10,r14,r4,r1
   .syntax divided
    .syntax unified
    umaal r11,r14,r6,r1
   .syntax divided
    .syntax unified
    umaal r12,r14,r5,r1
   .syntax divided
    .syntax unified
    str r2,[r0,#36]
    .syntax divided
    .syntax unified
    str r8,[r0,#40]
    .syntax divided
    .syntax unified
    str r9,[r0,#44]
    .syntax divided
    .syntax unified
    str r10,[r0,#48]
    .syntax divided
    .syntax unified
    str r11,[r0,#52]
    .syntax divided
    .syntax unified
    str r12,[r0,#56]
    .syntax divided
    .syntax unified
    str r14,[r0,#60]
    .syntax divided
    add SP,#12
   .syntax unified
    pop {r4,r5,r6,r7,r8,r9,r10,r11,r12,r15}

	.size	multiply256x256_asm, .-multiply256x256_asm
	
